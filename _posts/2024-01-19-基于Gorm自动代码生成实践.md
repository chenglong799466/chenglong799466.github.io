---
layout:     post
title:      基于Gorm自动代码生成实践
subtitle:   Based on Gorm automatic code generation practice
date:       2024-01-19
author:     chenglong
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:

- Mysql
- Golang

---

# 前言

在go的语言背景下，数据库的orm框架大多会选用gorm框架。但是gorm并没有提供一个可以自动生成模板类和crud方法的工具，

导致项目中每次新建库表都得手动生成表的模板类和crud方法，非常繁琐且容易出错。

因此，很多项目大多会选用开源的一些工具生成crud文件，但是选用开源的工具包生成也有一些问题需要解决。

- 适应开源框架支持的mysql版本
- 适应开源框架的代码风格
- 需要针对公司内代码检查工具（golint等等）做二次调整
- 自定义方法不能实现。

为了解决以上问题，可以考虑自己开发一个gorm的代码生成工具。


# 效果展示

 - 每个数据库表都会生成一个与表名相同的go文件（以本人项目的一个业务表`t_search_history_all`为例）

![](https://chenglong799466.github.io/img/基于Gorm自动代码生成实践01.png)

 - 文件内容主要分为标准模版和CRUD模版方法两部分
   1. Struct标准模板：支持大部分的**gorm标签**自动化生成，支持自定义struct名称生成规则，支持标准化**注释**生成
![](https://chenglong799466.github.io/img/基于Gorm自动代码生成实践02.png)
   2. CRUD模版方法：标准CRUD函数，默认生成**查询，新增，编辑sql方法**。可以根据项目所需扩展。可以自定义代码风格。
![](https://chenglong799466.github.io/img//基于Gorm自动代码生成实践03.png)


# 源码解析
  实现了自动化生成的代码逻辑，可以作为一个效率提升的工具使用，并且可以基于源码做二次开发。

  1. 基本步骤和原理
本地连接DB -》 基于gorm框架解析mysql表结构 -》 自定义template模版 -》 使用实际的mysql表结构信息填充模版 -》 输出至go文件
  2. go.mod文件











#  
https://github.com/chenglong799466/clox 源码地址
    




