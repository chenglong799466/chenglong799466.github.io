<!-- ============================================
     导航栏组件 (Navigation Bar Component)
     ============================================
     功能说明：
     1. 固定在页面顶部的响应式导航栏
     2. 支持移动端汉堡菜单切换
     3. 自动从Jekyll site.pages中生成导航菜单项
     ============================================ -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        
        <!-- ========================================
             导航栏头部区域 (Navbar Header)
             ========================================
             包含：
             - 移动端汉堡菜单按钮
             - 网站Logo/标题
             ======================================== -->
        <div class="navbar-header page-scroll">
            <!-- 移动端菜单切换按钮 (三条横线图标) -->
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <!-- 三条横线图标 -->
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            
            <!-- 网站品牌/Logo - 点击返回首页 -->
            <a class="navbar-brand" href="{{ site.baseurl }}/">{{ site.title }}</a>
        </div>

        <!-- ========================================
             导航菜单区域 (Navigation Menu)
             ========================================
             包含：
             - 首页链接（硬编码）
             - 动态生成的页面链接（从site.pages）
             ======================================== -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <!-- 首页链接 - 固定显示 -->
                    <li>
                        <a href="{{ site.baseurl }}/">Home</a>
                    </li>
                    
                    <!-- 动态生成的页面链接
                         遍历所有页面，只显示有title属性的页面
                         例如：about.html, tags.html等 -->
                    {% for page in site.pages %}{% if page.title %}
                    <li>
                        <a href="{{ page.url | prepend: site.baseurl }}">{{ page.title }}</a>
                    </li>
                    {% endif %}{% endfor %}
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<!-- ============================================
     导航栏交互脚本 (Navigation Interaction Script)
     ============================================
     功能说明：
     1. 替换Bootstrap默认的低性能导航栏动画
     2. 使用高性能的CSS3动画实现Material Design风格
     3. 处理移动端菜单的打开/关闭逻辑
     ============================================ -->
<script>
    // ========================================
    // 获取DOM元素引用
    // ========================================
    var $body   = document.body;                              // 页面body元素
    var $toggle = document.querySelector('.navbar-toggle');   // 汉堡菜单按钮
    var $navbar = document.querySelector('#huxblog_navbar');  // 导航栏容器
    var $collapse = document.querySelector('.navbar-collapse'); // 可折叠的菜单区域

    // ========================================
    // 自定义导航栏控制对象
    // ========================================
    var __HuxNav__ = {
        /**
         * 关闭导航菜单
         * 1. 移除'in'类名，触发CSS动画
         * 2. 等待400ms动画结束后，设置高度为0
         */
        close: function(){
            $navbar.className = " ";
            // 等待动画结束（400ms）
            setTimeout(function(){
                // 防止频繁切换导致的问题
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        
        /**
         * 打开导航菜单
         * 1. 设置高度为auto，让内容自适应
         * 2. 添加'in'类名，触发CSS动画
         */
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // ========================================
    // 绑定汉堡菜单按钮点击事件
    // ========================================
    $toggle.addEventListener('click', function(e){
        // 检查当前菜单状态，执行相反操作
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()  // 如果已打开，则关闭
        }else{
            __HuxNav__.open()   // 如果已关闭，则打开
        }
    })

    // ========================================
    // 点击页面其他区域关闭菜单
    // ========================================
    /**
     * 实现原理说明：
     * 
     * 由于使用了Fastclick库来解决iOS 300ms延迟问题，
     * 不能使用e.stopPropagation()阻止事件冒泡，
     * 因为这会破坏Fastclick的全局事件委托。
     * 
     * 解决方案：
     * 使用e.target过滤，只在点击非菜单区域时关闭菜单
     */
    document.addEventListener('click', function(e){
        // 如果点击的是汉堡按钮本身，不关闭菜单
        if(e.target == $toggle) return;
        // 如果点击的是汉堡按钮的图标条，不关闭菜单
        if(e.target.className == 'icon-bar') return;
        // 其他情况，关闭菜单
        __HuxNav__.close();
    })
</script>
